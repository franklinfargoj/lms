<?php
//pe($lead_data);die;
$statuses = $this->config->item('lead_status');
$assigned_to = 0;
$all_source = $this->config->item('lead_source');
?>
<link rel="stylesheet" href="<?php echo base_url('assets2/css/animate.min.css');?>">
<link rel="stylesheet" href="<?php echo base_url('assets2/css/timelify.css');?>">
<div class="page-title">
    <div class="container clearfix">
        <h3 class="text-center">Lead Life Cycle</h3>
    </div>
</div>
<span class="bg-top"></span>
    <div class="inner-content">
<div class="container">
            <span class="life-c">
                Lead Id : <?php echo isset($lead_data[0]['id']) && !empty($lead_data[0]['id']) ? $lead_data[0]['id'] : '';?> &nbsp;&nbsp;|&nbsp;&nbsp;
                Customer Name : <?php echo isset($lead_data[0]['customer_name']) && !empty($lead_data[0]['customer_name']) ? ucwords(strtolower($lead_data[0]['customer_name'])) :'';?> &nbsp;&nbsp;|&nbsp;&nbsp;
                Contact No : <?php echo isset($lead_data[0]['contact_no']) && !empty($lead_data[0]['contact_no']) ? ucwords(strtolower($lead_data[0]['contact_no'])) :'';?> &nbsp;&nbsp;|&nbsp;&nbsp;
                Lead Source : <?php echo isset($lead_data[0]['lead_source']) && !empty($lead_data[0]['lead_source']) ? ucwords(strtolower($all_source[$lead_data[0]['lead_source']])) :'';?>
            </span>
    <div class="timeline">
        <?php if(!empty($lead_data)){?>
            <br>

           <?php if (isset($lead_data[0])){?>
            <ul class="timeline-items">
            <li class="is-hidden timeline-item inverted"> <!-- Normal block, positionned to the left -->
                <h3>Lead Generated</h3>
                <hr>
                <p>
                <?php
                if($lead_data[0]['lead_source'] == 'analytics'){
                    echo "Generated By : Analytics<br><br>";
                }elseif($lead_data[0]['lead_source'] == 'tie_ups'){
                    echo "Generated By : Others<br><br>";
                }elseif($lead_data[0]['lead_source'] == 'enquiry'){
                    echo "Generated By : Website,IVR<br><br>";
                }else{
                    //echo $lead_data[0]['created_by_branch_id'];
                    $branchname= branchname($lead_data[0]['created_by_branch_id']);
                    $branchname = $branchname[0]['name'];
                    echo isset($lead_data[0]['generated']) && !empty($lead_data[0]['generated']) ? "Generated By : ".ucwords(strtolower($lead_data[0]['generated'])).' - '.$branchname.'<br><br>' : 'Generated By NA<br><br>';
                }

                ?>
                </p>
                <hr>
                <span>
                    <?php echo isset($lead_data[0]['generated_on']) && !empty($lead_data[0]['generated_on']) ? "Date : ".date('d-M-Y H:i:s',strtotime($lead_data[0]['generated_on'])) : "Date : NA"; ?>

                </span>
            </li>
            </ul>
            <?php }
            foreach ($lead_data as $key => $lead_value){
                $right = 'inverted';
                if(($key +1) %2==0){
                    $right = '';
                }
                if (isset($lead_value['reroute_from_branch_id']) &&  $lead_value['reroute_from_branch_id']!='' && $key !=0){?>
                    <ul class="timeline-items">
                        <li class="is-hidden timeline-item <?php echo $right;?>"> <!-- Normal block, positionned to the left -->
                            <h3><?php echo (isset($lead_value['status'])) ? "Lead Status : ".ucwords(strtolower($statuses[$lead_value['status']])) :'Lead Status NA';?></h3>
                            <hr>
                            <p>
                                <?php
                                $Rerout_to_branchname= branchname($lead_value['reroute_to_branch_id']);
                                $Rerout_to_branchname = $Rerout_to_branchname[0]['name'];
                                $Rerout_from_branchname= branchname($lead_value['reroute_from_branch_id']);
                                $Rerout_from_branchname = $Rerout_from_branchname[0]['name'];
                                echo $lead_value['reroute_from_branch_id'] ? "Reroute To Branch : ".$Rerout_to_branchname.'<br><br>' : 'Reroute To Branch : NA<br><br>';
                                echo isset($lead_value['reroute_to_branch_id']) && !empty($lead_value['reroute_to_branch_id']) ? "Reroute From Branch  : ".$Rerout_from_branchname.'<br><br>' : 'Reroute From Branch  : NA<br><br>';
                                ?>

                            </p>
                            <hr>
                            <span><?php
                                echo $lead_value['date'] ? "Date : ".date('d-M-Y H:i:s',strtotime($lead_value['date'])) : "Date : NA";
                                ?>
                            </span>
                        </li>
                    </ul>
                <?php }


                elseif($key!=0 && !isset($lead_value['reroute_from_branch_id'])){

                    ?>
                    <ul class="timeline-items">
                        <li class="is-hidden timeline-item <?php echo $right;?>"> <!-- Normal block, positionned to the left -->
                            <h3><?php echo (isset($lead_value['status'])) ? "Lead Status : ".ucwords(strtolower($statuses[$lead_value['status']])) :'Lead Status NA';?></h3>
                            <hr>
                            <p>
                                <?php
                                if($assigned_to == 0){
                                    echo isset($lead_value['employee_name']) && !empty($lead_value['employee_name']) ? "Assigned To : ".ucwords(strtolower($lead_value['employee_name'])).'<br><br>' : 'Assigned To : NA<br><br>';
                                    echo isset($lead_value['created_by_name']) && !empty($lead_value['created_by_name']) ? "Assigned By : ".ucwords(strtolower($lead_value['created_by_name'])).'<br><br>' : 'Assigned By : NA<br><br>';
                                }else{
                                    echo isset($lead_value['modified_by_name']) && !empty($lead_value['modified_by_name']) ? "Status Updated By : ".ucwords(strtolower($lead_value['modified_by_name'])) : 'Status Updated By : NA<br><br>';
                                }

                                $assigned_to++;?>
                            </p>
                            <hr>
                            <span><?php
                                echo isset($lead_value['date']) && !empty($lead_value['date']) ? "Date : ".date('d-M-Y H:i:s',strtotime($lead_value['date'])) : "Date : NA";
                                ?></span>
                        </li>
                    </ul>
                <?php }
            }} ?>
    </div>
</div>
</div>
<span class="bg-bottom"></span>
<script src="<?php echo base_url('assets2/js/jquery.timelify.js');?>"></script>
<script>
    $('.timeline').timelify({
        animLeft: "fadeInLeft",
        animCenter: "fadeInUp",
        animRight: "fadeInRight",
        animSpeed: 600,
        offset: 150
    });
</script>
